<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="data:image/svg+xml,%3Csvg%20t%3D%221717251856095%22%20class%3D%22icon%22%20viewBox%3D%220%200%201024%201024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20p-id%3D%222478%22%20width%3D%22200%22%20height%3D%22200%22%3E%3Cpath%20d%3D%22M384%20640H320A64%2064%200%201%200%20384%20704V640z%20m0%200V384h256v256H384z%20m256%2064a64%2064%200%201%200%2064-64H640v64zM704%20384A64%2064%200%201%200%20640%20320V384h64zM384%20320A64%2064%200%201%200%20320%20384H384V320z%20m85.333333%20234.666667h85.333334v-85.333334h-85.333334v85.333334z%20m85.333334-85.333334V320a149.333333%20149.333333%200%201%201%20149.333333%20149.333333H554.666667z%20m149.333333%2085.333334a149.333333%20149.333333%200%201%201-149.333333%20149.333333V554.666667h149.333333zM469.333333%20704A149.333333%20149.333333%200%201%201%20320%20554.666667H469.333333v149.333333zM320%20469.333333A149.333333%20149.333333%200%201%201%20469.333333%20320V469.333333H320z%22%20fill%3D%22%23000000%22%20p-id%3D%222479%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E" rel="icon"
          type="image/svg+xml">
    <title>配置管理</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #ddd;
        }

        .actions button {
            padding: 8px 12px;
            margin-right: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .actions button:hover {
            background-color: #45a049;
        }

        input[type="text"], input[type="password"] {
            padding: 8px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
        }

        .actions button {
            margin-right: 5px;
        }

        #submitPassword, #clearPassword, #refreshConfigs, #changePassword {
            padding: 8px 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        #submitPassword:hover, #clearPassword:hover, #refreshConfigs:hover, #changePassword:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<h1>配置管理</h1>

<label for="password">密码:</label>
<input id="password" type="password">
<button id="submitPassword">提交</button>
<button id="clearPassword">清除密码</button>
<button id="refreshConfigs">刷新配置</button>
<br><br>

<h2>修改密码</h2>
<label for="currentPassword">当前密码:</label>
<input id="currentPassword" type="password">
<label for="newPassword">新密码:</label>
<input id="newPassword" type="password">
<button id="changePassword">修改密码</button>
<br><br>

<h2>配置列表</h2>
<table id="configTable">
    <thead>
    <tr>
        <th>Path</th>
        <th>Target</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<h2>添加新配置</h2>
<label for="newPath">Path:</label>
<input id="newPath" type="text">
<label for="newTarget">Target:</label>
<input id="newTarget" type="text">
<button onclick="addConfig()">添加</button>

<script>
    let configs = [];

    document.getElementById('submitPassword').addEventListener('click', function () {
        const pwd = document.getElementById('password').value;
        localStorage.setItem('pwd', pwd);
        fetchConfigs();
    });

    document.getElementById('clearPassword').addEventListener('click', function () {
        localStorage.removeItem('pwd');
        document.getElementById('password').value = '';
    });

    document.getElementById('refreshConfigs').addEventListener('click', function () {
        fetchConfigs();
    });

    document.getElementById('changePassword').addEventListener('click', function () {
        changePassword();
    });

    document.addEventListener('DOMContentLoaded', function () {
        const pwd = localStorage.getItem('pwd');
        if (pwd) {
            document.getElementById('password').value = pwd;
        }
    });

    // 获取配置列表
    async function fetchConfigs() {
        try {
            const url = new URL(window.location.origin) + 'configs';
            const pwd = localStorage.getItem('pwd');
            fetch(
                url, {
                    headers: {
                        'Content-Type': 'application/json',
                        'pwd': pwd
                    },
                }).then(response => response.json()).then(data => {
                if (data.code === 200) {
                    configs = data.data;
                    loadConfigs();
                } else {
                    alert(data.msg);
                }
            }).catch((error) => {
                console.error('获取配置列表失败:', error);
            });
        } catch (error) {
            console.error('网络请求失败:', error);
        }
    }

    // 提交配置列表
    async function submitConfigs() {
        try {
            const url = new URL(window.location.origin) + 'configs';
            const pwd = localStorage.getItem('pwd');
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'pwd': pwd
                },
                body: JSON.stringify(configs)
            }).then(response => response.json()).then(data => {
                if (data.code === 200) {
                    alert('提交成功');
                } else {
                    alert(data.msg);
                }
            }).catch((error) => {
                console.error('提交配置列表失败:', error);
            });
        } catch (error) {
            console.error('网络请求失败:', error);
        }
    }

    async function changePassword() {
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;

        if (!currentPassword || !newPassword) {
            alert('请填写当前密码和新密码');
            return;
        }

        const url = new URL(window.location.origin) + 'eCmdPwd';
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'pwd': currentPassword
            },
            body: JSON.stringify({eCmdPwd: newPassword})
        }).then(response => response.json()).then(data => {
            if (data.code === 200) {
                alert('密码修改成功');
                localStorage.setItem('pwd', newPassword);
                document.getElementById('password').value = newPassword;
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
            } else {
                alert(data.msg);
            }
        }).catch((error) => {
            console.error('修改密码失败:', error);
        });
    }

    function loadConfigs() {
        const tbody = document.querySelector('#configTable tbody');
        tbody.innerHTML = ''; // 清空表格内容

        configs.forEach((config, index) => {
            const row = document.createElement('tr');

            const pathCell = document.createElement('td');
            pathCell.textContent = config.path;
            row.appendChild(pathCell);

            const targetCell = document.createElement('td');
            targetCell.textContent = config.target;
            row.appendChild(targetCell);

            const actionsCell = document.createElement('td');
            actionsCell.className = 'actions';

            const editButton = document.createElement('button');
            editButton.textContent = '修改';
            editButton.onclick = () => editConfig(index);
            actionsCell.appendChild(editButton);

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '删除';
            deleteButton.onclick = () => deleteConfig(index);
            actionsCell.appendChild(deleteButton);

            row.appendChild(actionsCell);

            tbody.appendChild(row);
        });
    }

    function addConfig() {
        const newPath = document.getElementById('newPath').value;
        const newTarget = document.getElementById('newTarget').value;

        if (newPath && newTarget) {
            configs.push({path: newPath, target: newTarget});
            loadConfigs();
            document.getElementById('newPath').value = '';
            document.getElementById('newTarget').value = '';
            submitConfigs();
        } else {
            alert('请填写完整的路径和目标URL');
        }
    }

    function editConfig(index) {
        const newPath = prompt('修改Path:', configs[index].path);
        const newTarget = prompt('修改Target:', configs[index].target);

        if (newPath !== null && newTarget !== null) {
            configs[index].path = newPath;
            configs[index].target = newTarget;
            loadConfigs();
            submitConfigs();
        }
    }

    function deleteConfig(index) {
        configs.splice(index, 1);
        loadConfigs();
        submitConfigs();
    }

    fetchConfigs();
</script>
</body>
</html>
