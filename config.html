<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>配置管理</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #ddd;
        }

        .actions button {
            padding: 8px 12px;
            margin-right: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .actions button:hover {
            background-color: #45a049;
        }

        input[type="text"], input[type="password"] {
            padding: 8px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
        }

        .actions button {
            margin-right: 5px;
        }

        #submitPassword, #clearPassword, #refreshConfigs {
            padding: 8px 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        #submitPassword:hover, #clearPassword:hover, #refreshConfigs:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<h1>配置管理</h1>

<label for="password">密码:</label>
<input id="password" type="password">
<button id="submitPassword">提交</button>
<button id="clearPassword">清除密码</button>
<button id="refreshConfigs">刷新配置</button>
<br><br>

<h2>配置列表</h2>
<table id="configTable">
    <thead>
    <tr>
        <th>Path</th>
        <th>Target</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<h2>添加新配置</h2>
<label for="newPath">Path:</label>
<input id="newPath" type="text">
<label for="newTarget">Target:</label>
<input id="newTarget" type="text">
<button onclick="addConfig()">添加</button>

<script>
    let configs = [];

    document.getElementById('submitPassword').addEventListener('click', function () {
        const pwd = document.getElementById('password').value;
        localStorage.setItem('pwd', pwd);
        fetchConfigs();
    });

    document.getElementById('clearPassword').addEventListener('click', function () {
        localStorage.removeItem('pwd');
        document.getElementById('password').value = '';
    });

    document.getElementById('refreshConfigs').addEventListener('click', function () {
        fetchConfigs();
    });

    document.addEventListener('DOMContentLoaded', function () {
        const pwd = localStorage.getItem('pwd');
        if (pwd) {
            document.getElementById('password').value = pwd;
        }
    });

    // 获取配置列表
    async function fetchConfigs() {
        try {
            const url = new URL(window.location.origin) + 'configs';
            const pwd = localStorage.getItem('pwd');
            fetch(
                url, {
                    headers: {
                        'Content-Type': 'application/json',
                        'pwd': pwd
                    },
                }).then(response => response.json()).then(data => {
                if (data.code === 200) {
                    configs = data.data;
                    loadConfigs();
                } else {
                    alert(data.msg);
                }
            }).catch((error) => {
                console.error('获取配置列表失败:', error);
            });
        } catch (error) {
            console.error('网络请求失败:', error);
        }
    }

    // 提交配置列表
    async function submitConfigs() {
        try {
            const url = new URL(window.location.origin) + 'configs';
            const pwd = localStorage.getItem('pwd');
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'pwd': pwd
                },
                body: JSON.stringify(configs)
            }).then(response => response.json()).then(data => {
                if (data.code === 200) {
                    alert('提交成功');
                } else {
                    alert(data.msg);
                }
            }).catch((error) => {
                console.error('提交配置列表失败:', error);
            });
        } catch (error) {
            console.error('网络请求失败:', error);
        }
    }

    function loadConfigs() {
        const tbody = document.querySelector('#configTable tbody');
        tbody.innerHTML = ''; // 清空表格内容

        configs.forEach((config, index) => {
            const row = document.createElement('tr');

            const pathCell = document.createElement('td');
            pathCell.textContent = config.path;
            row.appendChild(pathCell);

            const targetCell = document.createElement('td');
            targetCell.textContent = config.target;
            row.appendChild(targetCell);

            const actionsCell = document.createElement('td');
            actionsCell.className = 'actions';

            const editButton = document.createElement('button');
            editButton.textContent = '修改';
            editButton.onclick = () => editConfig(index);
            actionsCell.appendChild(editButton);

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '删除';
            deleteButton.onclick = () => deleteConfig(index);
            actionsCell.appendChild(deleteButton);

            row.appendChild(actionsCell);

            tbody.appendChild(row);
        });
    }

    function addConfig() {
        const newPath = document.getElementById('newPath').value;
        const newTarget = document.getElementById('newTarget').value;

        if (newPath && newTarget) {
            configs.push({path: newPath, target: newTarget});
            loadConfigs();
            document.getElementById('newPath').value = '';
            document.getElementById('newTarget').value = '';
            submitConfigs();
        } else {
            alert('请填写完整的路径和目标URL');
        }
    }

    function editConfig(index) {
        const newPath = prompt('修改Path:', configs[index].path);
        const newTarget = prompt('修改Target:', configs[index].target);

        if (newPath !== null && newTarget !== null) {
            configs[index].path = newPath;
            configs[index].target = newTarget;
            loadConfigs();
            submitConfigs();
        }
    }

    function deleteConfig(index) {
        configs.splice(index, 1);
        loadConfigs();
        submitConfigs();
    }

    fetchConfigs();
</script>
</body>
</html>
